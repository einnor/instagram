<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">
	<meta content="initial-scale=1.0, width=device-width" name="viewport">
	<title>Instagram | Post</title>

	<!-- css -->
	<link href="./css/base.min.css" rel="stylesheet">

	<!-- css for this project -->
	<link href="./css/project.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- favicon -->
	<!-- ... -->

	<!-- ie -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	<style type="text/css">
		header{
			height:50px;max-height:50px;
		}
		.timeposted{color:#999;font-size:12px;}
		.owner,.numberoflikes,.like,.comment,.numberofcomments{font-size:12px;color:#999;}
		.hidden{display: none;}
		/*.card-img{min-height: 300px;}*/
		.card-img img{width:100%;cursor: pointer;cursor: hand;}
		.hasliked{color:#F12938;}
	</style>
</head>
<body class="avoid-fout page-brand">
	<div class="avoid-fout-indicator avoid-fout-indicator-fixed">
		<div class="progress-circular progress-circular-center progress-circular-brand">
			<div class="progress-circular-wrapper">
				<div class="progress-circular-inner">
					<div class="progress-circular-left">
						<div class="progress-circular-spinner"></div>
					</div>
					<div class="progress-circular-gap"></div>
					<div class="progress-circular-right">
						<div class="progress-circular-spinner"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<header  class="header header-brand">
		<ul class="nav nav-list pull-left">
			<li>
				<a data-toggle="menu" href="#menu">
					<span class="icon icon-lg">menu</span>
				</a>
			</li>
		</ul>
		<a class="header-logo margin-left-no" style="font-weight:bold;" href="./">Instagram</a>
		<ul class="nav nav-list pull-right">
			<li>
				<a data-toggle="menu" href="#profile">
					<span class="access-hide">John Smith</span>
					<span class="avatar"><img alt="alt text for John Smith avatar" src="images/users/avatar-001.jpg"></span>
				</a>
			</li>
		</ul>
	</header>
	<nav aria-hidden="true" class="menu" id="menu" tabindex="-1">
		<div class="menu-scroll">
			<div class="menu-content">
				<a class="menu-logo" href="index.html">Instagram</a>
				<div class="form-group form-group-label form-group-brand">
					<div class="row">
						<div class="col-lg-10 col-lg-offset-1 col-sm-10 col-sm-offset-1">
							<label class="floating-label" for="search">Search <i class="fa fa-search"></i></label>
							<input class="form-control" id="search" name="search" type="text">
						</div>
					</div>
				</div>
			</div>
		</div>
	</nav>
	<nav aria-hidden="true" class="menu menu-right" id="profile" tabindex="-1">
		<div class="menu-scroll">
			<div class="menu-top">
				<div class="menu-top-img">
					<img alt="John Smith" src="images/samples/landscape.jpg">
				</div>
				<div class="menu-top-info">
					<a class="menu-top-user" href="javascript:void(0)"><span class="avatar pull-left"><img alt="alt text for John Smith avatar" src="images/users/avatar-001.jpg"></span><span class="loggedinuser">John Smith</span></a>
				</div>
				<div class="menu-top-info-sub">
					<small>Some additional information about John Smith</small>
				</div>
			</div>
			<div class="menu-content">
				<ul class="nav">
					<li>
						<a class="waves-attach" href="javascript:void(0)"><span class="icon icon-lg">account_box</span>Profile </a>
					</li>
					<li>
						<a class="waves-attach" href="new-post.html"><span class="icon icon-lg">add_to_photos</span>Upload Photo</a>
					</li>
					<li>
						<a class="waves-attach" href="login.html"><span class="icon icon-lg">exit_to_app</span>Logout</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="content" style="background:#f2f2f2;">
		<div class="container">
			<section class="content-inner">
				<div class="card-wrap">
					<div class="row module-body">
						<div class="col-lg-6 col-lg-offset-3 col-md-6-offset-3 col-sm-12 cloner hidden">
							<div class="card">
								<div class="card-main">
									<div class="card-header">
										<div class="card-header-side pull-left">
											<div class="avatar">
												<img alt="John Smith Avatar" src="images/users/avatar-001.jpg">
											</div>
										</div>
										<div class="card-inner">
											<span class="owner">@athmanGude</span><span class="pull-right timeposted"><span class="icon">alarm </span> <i></i></span>
										</div>
									</div>
									<div class="card-img">
										<img alt="alt text" src="images/samples/landscape.jpg">
									</div>
									<div class="card-inner">
										<p class="caption">Lorem ipsum dolor sit amet. Consectetur adipiscing elit.</p>
									</div>
									<div class="card-action">
										<div class="card-action-btn pull-left">
											<a class="btn btn-flat waves-attach like" href="javascript:void(0)"><span class="icon text-blue">favorite_border</span></a>&nbsp;<span class="numberoflikes">23 likes</span>
										</div>
										<div class="card-action-btn pull-right" style="padding-right:10px;">
											<a class="btn btn-flat waves-attach comment" href="javascript:void(0)"><span class="icon text-blue">comment</span></a>&nbsp;<span class="numberofcomments">11 comments</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row module-post">
						<div class="col-lg-6 col-lg-offset-3 col-md-6-offset-3 col-sm-12">
							<div class="card">
								<div class="card-main">
									<div class="card-header">
										<div class="card-header-side pull-left">
											<div class="avatar">
												<img alt="John Smith Avatar" src="images/users/avatar-001.jpg">
											</div>
										</div>
										<div class="card-inner">
											<form class="form" method="post">
												<input type="hidden" id="m_method" value="POST">
												<input type="hidden" id="m_url" value="api/comments/:id">
												<div class="row">
													<fieldset class="col-md-9">
														<div class="form-group form-group-label form-group-brand">
															<div class="row">
																<div class="col-md-12 col-sm-12">
																	<label class="floating-label" for="comment">Add a comment</label>
																	<textarea id="comment" name="comment" class="form-control" rows="1"></textarea>
																</div>
															</div>
														</div>
													</fieldset>
													<div class="form-group-btn col-md-3 col-sm-12">
														<button class="btn btn-brand waves-attach waves-button waves-light pull-right" type="submit">Comment</button>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row module-comments">
						<div class="col-lg-6 col-lg-offset-3 col-md-6-offset-3 col-sm-12">
							<h6 class=" text-center" style="color:#AAA;letter-spacing:3px;">ALL COMMENTS</h6>
						</div>

						<div class="col-lg-6 col-lg-offset-3 col-md-6-offset-3 col-sm-12 cloner2 hidden">
							<div class="card">
								<div class="card-main">
									<div class="card-header">
										<div class="card-header-side pull-left">
											<div class="avatar">
												<img alt="John Smith Avatar" src="images/users/avatar-001.jpg">
											</div>
										</div>
										<div class="card-inner">
											<span class="owner">@athmanGude</span><span class="pull-right timeposted"><span class="icon">alarm </span> <i></i></span>
										</div>
									</div>
									<div class="card-inner">
										<p class="comment">Lorem ipsum dolor sit amet. Consectetur adipiscing elit.</p>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</section>
		</div>
	</div>
	<footer class="footer">
		<div class="container">
			<p style="font-weight:bold;color:#AAA;">Instagram</p>
		</div>
	</footer>

	<div class="fbtn-container">
		<div class="fbtn-inner">
			<a class="fbtn fbtn-brand fbtn-lg" href="new-post.html"><span class="fbtn-ori icon">add</span></a>
		</div>
	</div>

	<!-- js -->
	<script src="js/jquery-1.11.3.min.js"></script>
	<script src="js/base.min.js"></script>

	<!-- js for this project -->
	<script src="js/project.min.js"></script>
	<script src="js/jquery.backstretch.min.js"></script>
    <script type="text/javascript" src="js/jquery.uploadfile.min.js"></script>
    <script type="text/javascript" src="js/extensions.js"></script>
    <script type="text/javascript" src="js/newcommon-login.js"></script>
	<script type="text/javascript">
		var post_id = window.location.href.split('?')[1];
		$(document).ready(function(e){
			$('form').on('submit',function(ev){
				$('#m_url').val('api/posts/comment/'.concat(post_id))
				ev.preventDefault();
				submitform($(this),function(data){
					if(data.response=="success"){$('form')[0].reset();location.reload();}
					else{//Something went wrong. alert!

					}
				})
			})
			var dataR = ajaxAPICall("GET","","api/posts/".concat(post_id),"application/json");
			dataR.success(function(data){
				$.each(data.response,function(i,item){
					clonepost(item.id,item.name,item.caption,item.timeposted,item.numberoflikes,item.numberofcomments,item.owner,item.hasliked)
				})
			})
			var dataR = ajaxAPICall("GET","","api/posts/comments/".concat(post_id),"application/json");
			dataR.success(function(data){
				$.each(data.response,function(i,item){
					clonecomment(item.id,item.owner,item.body,item.timeposted)
				})
			})

			// $('a.like').on('click',function(ev){
			// 	ev.preventDefault();
			// 	if($(this).hasClass('hasliked')){
			// 		$(this).removeClass('hasliked');$(this).addClass('hasnotliked');
			// 		$(this).siblings('.numberoflikes').html(parseInt($(this).siblings('.numberoflikes').html())-1)
			// 		// console.log(parseInt($(this).siblings('.numberoflikes').html()))
			// 		var post_id = $(this).closest('.col-lg-6').prop('id');
			// 		var jsondata = {'post_id':post_id}
			// 		var fdata = JSON.stringify(jsondata);
			// 		var dataR = ajaxAPICall("POST",fdata,"api/posts/like/".concat(post_id),"application/json")
			// 		dataR.success(function(data){
			// 			if(data.response=="success"){}
			// 			else{}
			// 		})
			// 		return false;
			// 	}
			// 	if($(this).hasClass('hasnotliked')){
			// 		$(this).removeClass('hasnotliked');$(this).addClass('hasliked');
			// 		$(this).siblings('.numberoflikes').html(parseInt($(this).siblings('.numberoflikes').html())+1)
			// 		// console.log(parseInt($(this).siblings('.numberoflikes').html()));
			// 		var post_id = $(this).closest('.col-lg-6').prop('id');
			// 		var jsondata = {'post_id':post_id}
			// 		var fdata = JSON.stringify(jsondata);
			// 		var dataR = ajaxAPICall("POST",fdata,"api/posts/like/".concat(post_id),"application/json")
			// 		dataR.success(function(data){
			// 			if(data.response=="success"){}
			// 			else{}
			// 		})
			// 		return false;
			// 	}
			// })

			function clonepost(id,filename,caption,timeposted,numberoflikes,numberofcomments,owner,hasliked){
				var cloner2 = $('.cloner');
				cloner2.clone(true,true).appendTo('.module-body');
				cloner2.removeClass('cloner');
				var cloner= $('.cloner');
				cloner.removeClass('hidden');
				cloner.prop('id',id);
				cloner.find('.owner').html(owner);
				cloner.find('.caption').html(caption);
				cloner.find('.timeposted i').html(timeposted);
				cloner.find('.card-img img').prop('src',filename.replace('../',''));
				cloner.find('.numberoflikes').html(numberoflikes);
				cloner.find('.numberofcomments').html(numberofcomments);
				console.log(hasliked)
				if(hasliked=='true'){cloner.find('.like').addClass('hasliked').removeClass('hasnotliked')}
				if(hasliked==null){cloner.find('.like').addClass('hasnotliked').removeClass('hasliked')}
				return cloner;
			}
			function clonecomment(id,owner,body,timeposted){
				var cloner2 = $('.cloner2');
				cloner2.clone(true,true).appendTo('.module-comments');
				cloner2.removeClass('cloner2');
				var cloner= $('.cloner2');
				cloner.removeClass('hidden');
				cloner.prop('id',id);
				cloner.find('.owner').html(owner);
				cloner.find('.comment').html(body);
				cloner.find('.timeposted i').html(timeposted);
				return cloner;
			}
		})
	</script>
</body>
</html>